<template>

    <div class="page">

        <div class="navbar">

            <div class="navbar-bg"></div>

            <div class="navbar-inner">

                <div class="left">

                    <a href="#" class="link back">

                        <i class="icon icon-back"></i>

                    </a>

                </div>

                <div class="title">

                    ${doc_type == 'peremeshenie' && $h`

                        Перемещение

                    `}

                    ${doc_type == 'prikhodniy_order' && $h`

                        Приходный ордер

                    `}

                    ${doc_type == 'raskhodniy_order' && $h`

                        Расходный ордер

                    `}

                    ${doc_type == 'postuplenie_ot_postavshika' && $h`

                        Поступление от поставщика

                    `}

                    ${doc_type == 'razmeshenie_po_yacheykam' && $h`

                        Размещение по ячейкам

                    `}

                    ${doc_type == 'otbor_po_yacheykam' && $h`

                        Отбор по ячейкам

                    `}

                </div>

                <div class="right">

                    <a @click="${addDocument}" href="#" class="link">

                        <i class="icon material-icons">add</i>

                    </a>

                </div>

            </div>

        </div>

        <div class="page-content">

            ${documents.length > 0 && $h`

                <div class="list">

                    <ul>

                        ${documents.map((document) => $h`

                            <li class="swipeout">

                                <a @click="${() => openDocument(document.Номер)}" class="item-content item-link swipeout-content">

                                    <div class="item-inner">

                                        <div class="item-title">${document.Номер}</div>

                                    </div>

                                </a>

                                <div class="swipeout-actions-right">

                                    <a @click="${() => removeDocument(document.Номер)}" href="#" class="color-red swipeout-close button-remove">Удалить</a>

                                </div>

                            </li>

                        `)}

                    </ul>

                </div>

            `}

            ${documents.length <= 0 && $h`

                <div class="margin">У вас нет добавленных документов.</div>

            `}

        </div>

    </div>

</template>

<style>


</style>

<script>

    export default (props, { $on, $f7, $f7route, $f7router, $el, $update }) => {

        const doc_type = $f7route.params.type;

        let documents = [];

        const initDocuments = () => {

            documents = app.documents.data.filter(function (document) {

                return document.doc_type == doc_type;

            });

            $update();

        }

        const openDocument = (doc_num) => {

            $f7router.navigate('/documents/' + doc_type + '/' + doc_num);

        }

        const removeDocument = (doc_num) => {

            app.dialog.confirm('Вы уверены?', 'Внимание', function () {

                app.documents.remove(doc_num, function () {

                    initDocuments();

                });

            });

        }

        const addDocument = () => {

            app.dialog.prompt('', 'Введите номер документа...', function (value) {

                if (value.length == 0) {

                    app.dialog.alert('Похоже вы ничего не ввели...', 'Упс :(');

                    return false;

                }

                let document = app.documents.data.find(function (document) {

                    return document.Номер == value;

                });

                if (document) {

                    app.dialog.alert('', 'Документ уже добавлен!');

                } else {

                    app.documents.find(doc_type, value, function () {

                        initDocuments();

                    });

                }

            });

        }

        $on('pageInit', function () {

            initDocuments();

        });

        return $render;

    }

</script>